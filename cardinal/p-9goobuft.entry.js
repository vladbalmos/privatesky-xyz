import{r as t,h as e,g as i}from"./p-bd5842d7.js";import{i as s,s as r,c as n}from"./p-18c69f0f.js";import{T as o}from"./p-7aa21657.js";import{C as c}from"./p-92afb37f.js";var l=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};const a=class{constructor(e){t(this,e),this.activeChapter=null,this.chapters=[],this.title="",this.componentFullyLoaded=!1,this.handleScrollEvent=t=>{(function(t){const e=t.parentEventData&&t.parentEventData;if(!e)return;let i=Array.from(this.element.querySelectorAll("psk-chapter"));this.activeChapter=null;const r=e.scrollTop,n=e.offsetHeight;let o=function(t){let e=[];return t.forEach(t=>{const i=t.getAttribute("guid");if(!i)return null;const r=t.getElementsByClassName("card psk-card")?t.getElementsByClassName("card psk-card")[0]:null;if(!r)return null;const n=function(t,e){let i=t.offsetTop;const r=t.offsetHeight;let n=e[e.length-1]?e[e.length-1]:null;if(n){let{verticalOffset:o,height:c}=n;if(o>i||o+c>i+r){const r=s(t,"psk-chapter",2),n=e.find(t=>r&&t.guid===r.getAttribute("guid"));n&&(i+=n.verticalOffset)}}return i}(r,e);e.push({guid:i,height:r.offsetHeight,verticalOffset:n,title:t.title})}),e}(i);(function(t,e,i){let s=t.find(t=>e<=t.verticalOffset&&t.verticalOffset+t.height<=e+i);if(s)return void(this.activeChapter=s.guid);let r=t.filter(t=>e>=t.verticalOffset&&(e+i<=t.verticalOffset+t.height||e<=t.verticalOffset+t.height));r.length>0?this.activeChapter=r[r.length-1].guid:t.length>0&&(this.activeChapter=t[0].guid)}).call(this,o,r,n)}).call(this,t)}}receiveChapters(t){if(t.stopImmediatePropagation(),!t.detail)return;const e=Object.assign({},t.detail),i=this.chapters.findIndex(t=>e.guid===t.guid),s=[...this.chapters];if(-1===i)return s.push(Object.assign({},e)),void(this.chapters=JSON.parse(JSON.stringify(s)));s[i]=Object.assign({},e),this.chapters=JSON.parse(JSON.stringify(s))}_checkForChapterScrolling(){if(-1===window.location.href.indexOf("chapter="))return;const t=window.location.href.split("chapter=")[1];setTimeout(()=>{r(t,this.element)},50)}_sendTableOfContentChapters(){n("psk-send-toc",{bubbles:!0,composed:!0,cancelable:!0,detail:{chapters:this.chapters,active:this.activeChapter}},!0)}componentDidLoad(){this.componentFullyLoaded=!0,document.addEventListener("pageScroll",this.handleScrollEvent,!0),this._checkForChapterScrolling()}disconnectedCallback(){document.removeEventListener("pageScroll",this.handleScrollEvent,!0)}render(){return this._sendTableOfContentChapters(),e("div",null,e("nav",null,e("h3",null,this.title)),e("div",{class:"page-content container"},this.componentFullyLoaded?e("slot",null):e("psk-ui-loader",{shouldBeRendered:!0})))}get element(){return i(this)}};l([c()],a.prototype,"activeChapter",void 0),l([o({description:"This property will be used as the title for the page.",isMandatory:!1,propertyType:"string"})],a.prototype,"title",void 0),l([o({description:"This property is the name of the table of content.",isMandatory:!1,propertyType:"string"})],a.prototype,"tocTitle",void 0);export{a as psk_page};